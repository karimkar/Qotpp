<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù‚Ø·Ø¨ - Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù‚Ø·Ø¨">
    <meta name="description" content="Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹">
    <meta name="keywords" content="Ù…ØªØ¬Ø±, ØªØ³ÙˆÙ‚, ØªÙˆØµÙŠÙ„, Ø¨Ù‚Ø§Ù„Ø©">
    
    <!-- PWA Manifest -->
    <link rel="manifest" id="app-manifest">
    
    <!-- ØªØ­Ù…ÙŠÙ„ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        /* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ */
        /* ... */
    </style>
</head>

<body class="min-h-screen">
    <!-- Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ -->
    <!-- ... -->

    <script>
        // === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„ ===
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Apps Script - Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL';
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ
        const categories = [ /* ... */ ];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        let currentSubProducts = [];
        let currentCategory = null;
        let currentFilter = 'all';
        let allProducts = [];
        let verificationCode = '';
        let countdownInterval = null;

        // === Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ===
        
        // Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
        function saveCartToLocalStorage() {
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function saveOrderToSheet(orderData) {
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'saveOrder',
                        data: orderData
                    })
                });
                
                return await response.json();
            } catch (error) {
                console.error('Error saving order:', error);
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                saveOrderLocally(orderData);
                return {success: false, error: error.message};
            }
        }

        // Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function saveOrderLocally(orderData) {
            let orders = JSON.parse(localStorage.getItem('pendingOrders') || '[]');
            orders.push({
                ...orderData,
                id: Date.now(),
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('pendingOrders', JSON.stringify(orders));
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
        async function syncPendingOrders() {
            const pendingOrders = JSON.parse(localStorage.getItem('pendingOrders') || '[]');
            
            for (let i = pendingOrders.length - 1; i >= 0; i--) {
                const order = pendingOrders[i];
                const result = await saveOrderToSheet(order);
                if (result.success) {
                    // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù†Ø§Ø¬Ø­Ø©
                    pendingOrders.splice(i, 1);
                    showToast('âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø·Ù„Ø¨: ' + order.id);
                }
            }
            localStorage.setItem('pendingOrders', JSON.stringify(pendingOrders));
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ø¨Ø± EmailJS
        async function sendOrderConfirmation(orderData, customerEmail) {
            try {
                const templateParams = {
                    to_email: customerEmail,
                    customer_name: orderData.customerName,
                    order_id: orderData.id,
                    order_total: orderData.total.toFixed(2),
                    order_items: orderData.items.map(item => 
                        `${item.name} - ${item.quantity} x ${item.price} Ø¯ÙŠÙ†Ø§Ø±`
                    ).join('\n'),
                    customer_phone: orderData.phone,
                    customer_address: orderData.address,
                    from_store: 'Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù‚Ø·Ø¨'
                };

                const response = await emailjs.send(
                    'YOUR_SERVICE_ID', // Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                    'YOUR_TEMPLATE_ID', // Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                    templateParams
                );
                
                return {success: true, response};
            } catch (error) {
                console.error('Failed to send email:', error);
                return {success: false, error};
            }
        }

        // === ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ===
        
        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cartItems.find(item => item.productId === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartItems.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    imageUrl: product.imageUrl,
                    quantity: 1
                });
            }
            
            saveCartToLocalStorage();
            renderCart();
            showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
        async function completeOrder(orderData) {
            showToast('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...');
            
            try {
                // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const saveResult = await saveOrderToSheet(orderData);
                
                if (saveResult.success) {
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„ØªØ£ÙƒÙŠØ¯
                    const emailResult = await sendOrderConfirmation(orderData, 'aloosh1011@outlook.com');
                    
                    if (emailResult.success) {
                        showToast('ğŸ‰ ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
                        
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ù„Ø©
                        cartItems = [];
                        saveCartToLocalStorage();
                        renderCart();
                        updateCartModal();
                        
                        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹
                        closeModal('payment-modal');
                    } else {
                        showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ØŒ ÙˆÙ„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ.');
                    }
                } else {
                    showToast('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§.');
                }
            } catch (error) {
                console.error('Order completion error:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡
        function checkout() {
            if (cartItems.length === 0) {
                showToast('Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©');
                return;
            }
            closeModal('cart-modal');
            openPaymentModal();
        }

        // === Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ===
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ PWA
            setupManifest();
            registerServiceWorker();
            setupPWAInstall();
            setupNetworkStatus();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ EmailJS
            emailjs.init("YOUR_PUBLIC_KEY"); // Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            hideSplashScreen();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª');
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            generateAllProducts();
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            renderCategories();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            renderCart();
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            syncPendingOrders();
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById('cart-header-btn').addEventListener('click', openCartModal);
            document.getElementById('contact-us-btn').addEventListener('click', openContactUsModal);
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯ÙØ¹
            document.getElementById('payment-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const orderData = {
                    id: 'ORD-' + Date.now(),
                    customerName: formData.get('customerName'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    paymentMethod: formData.get('paymentMethod'),
                    items: cartItems,
                    total: cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                await completeOrder(orderData);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£Ø®Ø±Ù‰
            document.getElementById('login-form').addEventListener('submit', handleLoginForm);
            document.getElementById('verification-form').addEventListener('submit', handleVerificationForm);
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            window.addEventListener('scroll', updateReadingProgress);
            
            console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ
        // ...
    </script>
</body>
</html>
